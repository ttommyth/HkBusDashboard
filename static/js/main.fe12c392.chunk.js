(this["webpackJsonphk-bus-dashboard"]=this["webpackJsonphk-bus-dashboard"]||[]).push([[0],{125:function(t,e,n){},126:function(t,e,n){},145:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(16),c=n.n(o),u=(n(125),n(126),n(85)),i=n(60),s=n(91);u.a.use(s.a).use(i.e).init({resources:{en:{translation:{"Welcome to React":"Welcome to React and react-i18next",add_route:"Add Route",route_not_available:"Route not available"}},"zh-HK":{translation:{"Welcome to React":"Bienvenue \xe0 React et react-i18next",add_route:"\u65b0\u589e\u8def\u7dda",route_not_available:"\u672a\u6709\u53ef\u7528\u73ed\u6b21"}},"zh-CN":{translation:{"Welcome to React":"Bienvenue \xe0 React et react-i18next",add_route:"\u65b0\u589e\u8def\u7dda",route_not_available:"\u672a\u6709\u53ef\u7528\u73ed\u6b21"}}},fallbackLng:"en",interpolation:{escapeValue:!1}});u.a;var l=n(74),d=n(14),b=n(39),j=n(17),f=n.n(j),v=n(26),h=n(20),p=n(178),O=n(198),x=n(48),g=n(180),m=n(182),k=n(183),y=n(184),C=n(193),w=n(186),_=n(202),S=n(100),q=n.n(S),I=n(98),R=n.n(I),T=n(196),N=n(4),E=Object(p.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})}));function A(t,e,n){return n.indexOf(t)===e}var F=function(t,e){return"zh-HK"===e?null===t||void 0===t?void 0:t.name_tc:"zh-CN"===e?null===t||void 0===t?void 0:t.name_sc:null===t||void 0===t?void 0:t.name_en},z=function(t){t.data;var e=t.stops,n=t.routeStops,r=t.routes,o=Object(_.a)(),c=o.t,u=o.i18n,i=(E(),Object(x.a)(),a.useState(!1)),s=Object(h.a)(i,2),l=s[0],d=s[1],j=a.useState(""),p=Object(h.a)(j,2),O=p[0],S=p[1],I=a.useState(""),z=Object(h.a)(I,2),H=z[0],L=z[1],W=a.useState(""),D=Object(h.a)(W,2),J=D[0],K=D[1],M=a.useState(""),B=Object(h.a)(M,2),P=B[0],G=B[1],V=a.useMemo((function(){return{I:n.filter((function(t){return t.route===O&&"I"===t.bound&&t.service_type===H})).sort((function(t,e){return+e.seq-+t.seq})),O:n.filter((function(t){return t.route===O&&"O"===t.bound&&t.service_type===H})).sort((function(t,e){return+e.seq-+t.seq}))}}),[n,O,H]);a.useEffect((function(){L(""),K(""),G("")}),[O]),a.useEffect((function(){K(""),G("")}),[H]),a.useEffect((function(){G("")}),[J]),a.useEffect((function(){}),[P]);var Q=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onRouteAdded({routeNumber:O,service_type:H,direction:J,seq:+P});case 2:if(!e.sent){e.next=5;break}S(""),d(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(N.jsx)(N.Fragment,{children:l?Object(N.jsxs)(g.a,{children:[Object(N.jsx)(m.a,{title:c("add_route"),action:Object(N.jsx)(k.a,{onClick:function(){return d(!1)},children:Object(N.jsx)(R.a,{})})}),Object(N.jsxs)(y.a,{children:[Object(N.jsx)(T.a,{value:O,onChange:function(t,e){S(null!==e&&void 0!==e?e:"")},options:r.map((function(t){return t.route})).filter(A),getOptionLabel:function(t){return t},renderInput:function(t){return Object(N.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:c("route"),variant:"outlined",fullWidth:!0}))}}),O&&Object(N.jsx)(T.a,{value:H,onChange:function(t,e){L(null!==e&&void 0!==e?e:"")},options:r.filter((function(t){return t.route==O})).map((function(t){return t.service_type})).filter(A),getOptionLabel:function(t){return t},renderInput:function(t){return Object(N.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:c("service_type"),variant:"outlined",fullWidth:!0}))}}),H&&Object(N.jsx)(T.a,{value:J,onChange:function(t,e){K(null!==e&&void 0!==e?e:"")},options:["I","O"],getOptionLabel:function(t){var n;return null!==(n=F(e.find((function(e){var n,a;return e.stop===(null===(n=V[t])||void 0===n||null===(a=n.find((function(t){return!0})))||void 0===a?void 0:a.stop)})),u.language))&&void 0!==n?n:""},renderInput:function(t){return Object(N.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:c("direction"),variant:"outlined",fullWidth:!0}))}}),J&&Object(N.jsx)(T.a,{value:P,onChange:function(t,e){G(null!==e&&void 0!==e?e:"")},options:n.filter((function(t){return t.route===O&&t.bound===J})).map((function(t){return t.seq})),getOptionLabel:function(t){var n;return null!==(n=F(e.find((function(e){var n,a;return e.stop===(null===(n=V[J])||void 0===n||null===(a=n.find((function(e){return e.route===O&&e.bound===J&&e.seq===t})))||void 0===a?void 0:a.stop)})),u.language))&&void 0!==n?n:""},renderInput:function(t){return Object(N.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:c("stop_name"),variant:"outlined",fullWidth:!0}))}}),P&&Object(N.jsx)(w.a,{variant:"contained",color:"primary",onClick:function(){return Q()},children:c("addToMonitorList")})]})]}):Object(N.jsx)(g.a,{children:Object(N.jsx)(y.a,{style:{alignContent:"center",alignItems:"center"},children:Object(N.jsx)(k.a,{onClick:function(){return d(!0)},children:Object(N.jsx)(q.a,{})})})})})},H=n(108),L=n(57),W=n(187),D=n(25),J=n.n(D),K=n(197),M=n(200),B=a.createContext({}),P=function(t){var e=a.useState(""),n=Object(h.a)(e,2),r=n[0],o=n[1];return Object(N.jsx)(B.Provider,{value:{auth:r,setAuth:o},children:t.children})},G=function(){var t=a.useContext(B);return{auth:t.auth,setAuth:t.setAuth}},V=n(75),Q=n(194),U=n(199),X=n(101),Y=n.n(X),Z=(n(140),n(141),Object(p.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})}))),$=function(t){var e,n,r,o=t.data,c=t.stops,u=t.routeStops,i=Object(_.a)(),s=i.t,l=i.i18n,d=(Z(),Object(x.a)(),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=Object(_.a)(),n=(e.t,e.i18n),r=a.useState(J()().locale(n.language)),o=Object(h.a)(r,2),c=o[0],u=o[1];return a.useEffect((function(){var e=setInterval((function(){u(J()().locale(n.language))}),t);return function(){clearInterval(e)}}),[t]),{now:c}}().now),b=a.useMemo((function(){var t;null===o||void 0===o||o.request;return null===o||void 0===o||null===(t=o.eta)||void 0===t?void 0:t.map((function(t){return{etaData:t}}))}),[o]),j=a.useMemo((function(){if(o&&c&&u){var t,e,n=null===o||void 0===o?void 0:o.request;return c[null!==(t=null===(e=u.find((function(t){var e;return t.route===(null===n||void 0===n?void 0:n.routeNumber)&&t.bound===(null===n||void 0===n?void 0:n.direction)&&t.seq===(null===n||void 0===n||null===(e=n.seq)||void 0===e?void 0:e.toString())})))||void 0===e?void 0:e.stop)&&void 0!==t?t:""]}return null}),[o,c,u]);return Object(N.jsx)(N.Fragment,{children:Object(N.jsxs)(g.a,{children:[Object(N.jsx)(m.a,{title:(null===o||void 0===o||null===(e=o.request)||void 0===e?void 0:e.routeNumber)+" - "+(n=j,r=l.language,"zh-HK"===r?null===n||void 0===n?void 0:n.name_tc:"zh-CN"===r?null===n||void 0===n?void 0:n.name_sc:null===n||void 0===n?void 0:n.name_en),action:Object(N.jsx)(k.a,{"aria-label":"delete",onClick:function(){return t.onRemoveClicked(null===o||void 0===o?void 0:o.request)},children:Object(N.jsx)(Y.a,{})})}),Object(N.jsxs)(y.a,{children:[(null==b||b.length<=0)&&Object(N.jsx)(V.a,{variant:"h2",display:"inline",children:s("route_not_available")}),null===b||void 0===b?void 0:b.map((function(t,e){var n,a,r;return Object(N.jsx)(N.Fragment,{children:Object(N.jsxs)(Q.a,{display:"flex",children:[Object(N.jsx)(Q.a,{flexGrow:1,children:null==t.etaData.eta?Object(N.jsx)(V.a,{variant:0===e?"h2":1===e?"h5":"h6",display:"inline",children:s("route_not_available")}):Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(V.a,{variant:0===e?"h2":1===e?"h5":"h6",display:"inline",children:null===(n=J()(t.etaData.eta))||void 0===n||null===(a=n.locale(l.language))||void 0===a?void 0:a.from(d)}),Object(N.jsx)(U.a,{label:null===(r=J()(t.etaData.eta))||void 0===r?void 0:r.format("HH:mm")})]})}),Object(N.jsx)(Q.a,{})]},"etaRow"+e)})}))]})]})})},tt=Object(p.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})})),et=[{path:"/:pasteKey?",component:function(){var t,e,n,r,o,c,u,i,s,l,b=Object(d.f)().pasteKey,j=(tt(),Object(x.a)(),G()),p=j.auth,O=(j.setAuth,a.useState("")),g=Object(h.a)(O,2),m=g[0],k=g[1],y=a.useState(null),C=Object(h.a)(y,2),w=C[0],_=C[1],S=Object(K.a)(["gist",b],Object(v.a)(f.a.mark((function t(){var e,n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://api.github.com/gists/".concat(b),{});case 2:return e=t.sent,t.next=5,e.json();case 5:return n=t.sent,k(Object.entries(n.files).find((function(t){return!0}))[0]),t.abrupt("return",JSON.parse(Object.entries(n.files).find((function(t){return!0}))[1].content));case 8:case"end":return t.stop()}}),t)}))),{}),q=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-eta/".concat(e.routeNumber,"/").concat(e.service_type));case 2:return n=t.sent,t.next=5,n.json();case 5:return a=t.sent,t.abrupt("return",a.data.filter((function(t){return t.dir===e.direction&&t.seq===e.seq})));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=Object(M.a)(null!==(t=null===w||void 0===w||null===(e=w.data)||void 0===e?void 0:e.map((function(t){return{queryKey:["routeEta",t.routeNumber,t.service_type,t.direction,t.seq],queryFn:function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,q(t);case 3:return e.t1=e.sent,e.abrupt("return",{request:e.t0,eta:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refetchInterval:1e4,cacheTime:0}})))&&void 0!==t?t:[]),R=Object(K.a)("routes",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),T=Object(K.a)("stops",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),E=Object(K.a)("routeStops",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-stop");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),A=a.useMemo((function(){var t={};return T.data&&T.data.data.forEach((function(e){t[e.stop]=e})),t}),[T.data]);a.useEffect((function(){S.data&&_(S.data)}),[S.data]);var F=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={type:"subscribedRouteStop",version:"1.0",generated_timestamp:J()().toDate(),data:null!==(n=null===w||void 0===w||null===(a=w.data)||void 0===a?void 0:a.filter((function(t){return t!==e})))&&void 0!==n?n:[]},t.next=3,fetch("https://api.github.com/gists/".concat(b),{method:"PATCH",headers:{Authorization:"token "+p,"Content-Type":"application/vnd.github.v3.text+json"},body:JSON.stringify({description:"Edit gist",files:Object(L.a)({},m,{content:JSON.stringify(r,null,2)})},null,2)});case 3:t.sent,_(r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),D=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={type:"subscribedRouteStop",version:"1.0",generated_timestamp:J()().toDate(),data:[].concat(Object(H.a)(null!==(n=null===w||void 0===w?void 0:w.data)&&void 0!==n?n:[]),[e])},t.next=3,fetch("https://api.github.com/gists/".concat(b),{method:"PATCH",headers:{Authorization:"token "+p,"Content-Type":"application/vnd.github.v3.text+json"},body:JSON.stringify({description:"Edit gist",files:Object(L.a)({},m,{content:JSON.stringify(a,null,2)})},null,2)});case 3:return r=t.sent,_(a),t.abrupt("return",r.ok);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(N.jsx)(N.Fragment,{children:null==b?Object(N.jsx)(W.a,{container:!0,spacing:2}):Object(N.jsxs)(W.a,{container:!0,spacing:2,children:[null===I||void 0===I?void 0:I.map((function(t,e){var n,a;return Object(N.jsx)(W.a,{item:!0,xs:12,xl:4,md:6,children:Object(N.jsx)($,{onRemoveClicked:function(t){return F(t)},stops:null!==A&&void 0!==A?A:{},data:t.data,routeStops:null!==(n=null===(a=E.data)||void 0===a?void 0:a.data)&&void 0!==n?n:[]})},"eta"+e)})),Object(N.jsx)(W.a,{item:!0,xs:12,xl:4,md:6,children:Object(N.jsx)(z,{onRouteAdded:function(t){return D(t)},stops:null!==(n=null===(r=T.data)||void 0===r?void 0:r.data)&&void 0!==n?n:[],data:null!==(o=null===(c=S.data)||void 0===c?void 0:c.data)&&void 0!==o?o:[],routes:null!==(u=null===(i=R.data)||void 0===i?void 0:i.data)&&void 0!==u?u:[],routeStops:null!==(s=null===(l=E.data)||void 0===l?void 0:l.data)&&void 0!==s?s:[]})})]})})},routes:[]}],nt=n(105),at=n(190),rt=n(107),ot=n(201),ct=n(188),ut=n(189),it=n(103),st=n.n(it),lt=n(104),dt=n.n(lt),bt=function(t){var e=a.useState(null),n=Object(h.a)(e,2),r=n[0],o=n[1],c=Object(_.a)(),u=(c.t,c.i18n),i=G(),s=i.auth,d=i.setAuth,b=a.useState(""),j=Object(h.a)(b,2),p=j[0],O=j[1],x=function(){var t=Object(v.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o(null),e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,u.changeLanguage(e);case 5:J.a.locale(e);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)(rt.a,{id:"simple-menu",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(){return x(null)},children:[Object(N.jsx)(ot.a,{onClick:function(){return x("en")},children:"English"}),Object(N.jsx)(ot.a,{onClick:function(){return x("zh-CN")},children:"\u7c21\u9ad4\u4e2d\u6587"}),Object(N.jsx)(ot.a,{onClick:function(){return x("zh-HK")},children:"\u6b63\u9ad4\u4e2d\u6587"})]}),Object(N.jsx)(ct.a,{position:"static",children:Object(N.jsx)(ut.a,{style:{width:"100%"},children:Object(N.jsxs)(Q.a,{display:"flex",style:{width:"100%"},children:[Object(N.jsxs)(Q.a,{flexGrow:1,children:[Object(N.jsx)(k.a,{edge:"end",color:"inherit","aria-label":"language",onClick:function(t){o(t.currentTarget)},children:Object(N.jsx)(st.a,{})}),Object(N.jsx)(C.a,{value:s,onChange:function(t){return d(t.target.value)},label:"GitHub Token",style:{width:500}})]}),Object(N.jsxs)(Q.a,{children:[Object(N.jsx)(C.a,{value:p,onChange:function(t){return O(t.target.value)},placeholder:"",label:"Push To",style:{width:500}}),Object(N.jsx)(k.a,{edge:"end",color:"inherit","aria-label":"language",component:l.b,to:"/"+p,children:Object(N.jsx)(dt.a,{})})]})]})})}),t.children]})},jt=function(){var t=Object(x.a)();return Object(N.jsx)(N.Fragment,{children:Object(N.jsx)(l.a,{basename:"/HkBusDashboard",children:Object(N.jsx)(d.c,{children:Object(N.jsx)(bt,{children:Object(N.jsx)(at.a,{maxWidth:"xl",style:{paddingTop:t.spacing(2)},children:Object(nt.a)(et)})})})})})},ft=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,204)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,o=e.getLCP,c=e.getTTFB;n(t),a(t),r(t),o(t),c(t)}))},vt=n(195),ht=n(73),pt=n(106),Ot=n(191),xt=n(192),gt=new vt.a({defaultOptions:{}}),mt=Object(pt.a)({palette:{type:"dark"}});c.a.render(Object(N.jsx)(r.a.StrictMode,{children:Object(N.jsxs)(Ot.a,{theme:mt,children:[Object(N.jsx)(xt.a,{}),Object(N.jsx)(P,{children:Object(N.jsx)(ht.a,{client:gt,children:Object(N.jsx)(jt,{})})})]})}),document.getElementById("root")),ft()}},[[145,1,2]]]);
//# sourceMappingURL=main.fe12c392.chunk.js.map