(this["webpackJsonphk-bus-dashboard"]=this["webpackJsonphk-bus-dashboard"]||[]).push([[0],{124:function(t,e,n){},125:function(t,e,n){},144:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(16),u=n.n(o),c=(n(124),n(125),n(84)),i=n(57),s=n(90);c.a.use(s.a).use(i.e).init({resources:{en:{translation:{"Welcome to React":"Welcome to React and react-i18next",add_route:"Add Route",route_not_available:"Route not available"}},"zh-HK":{translation:{"Welcome to React":"Bienvenue \xe0 React et react-i18next",add_route:"\u65b0\u589e\u8def\u7dda",route_not_available:"\u672a\u6709\u53ef\u7528\u73ed\u6b21"}},"zh-CN":{translation:{"Welcome to React":"Bienvenue \xe0 React et react-i18next",add_route:"\u65b0\u589e\u8def\u7dda",route_not_available:"\u672a\u6709\u53ef\u7528\u73ed\u6b21"}}},fallbackLng:"en",interpolation:{escapeValue:!1}});c.a;var l=n(103),d=n(14),b=n(39),j=n(17),f=n.n(j),v=n(26),p=n(21),h=n(177),O=n(197),x=n(48),g=n(179),m=n(181),k=n(182),y=n(183),C=n(192),_=n(185),w=n(201),S=n(99),q=n.n(S),I=n(97),R=n.n(I),N=n(195),T=n(4),E=Object(h.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})}));function A(t,e,n){return n.indexOf(t)===e}var F=function(t,e){return"zh-HK"===e?null===t||void 0===t?void 0:t.name_tc:"zh-CN"===e?null===t||void 0===t?void 0:t.name_sc:null===t||void 0===t?void 0:t.name_en},z=function(t){t.data;var e=t.stops,n=t.routeStops,r=t.routes,o=Object(w.a)(),u=o.t,c=o.i18n,i=(E(),Object(x.a)(),a.useState(!1)),s=Object(p.a)(i,2),l=s[0],d=s[1],j=a.useState(""),h=Object(p.a)(j,2),O=h[0],S=h[1],I=a.useState(""),z=Object(p.a)(I,2),H=z[0],L=z[1],W=a.useState(""),D=Object(p.a)(W,2),J=D[0],K=D[1],M=a.useState(""),B=Object(p.a)(M,2),P=B[0],G=B[1],V=a.useMemo((function(){return{I:n.filter((function(t){return t.route===O&&"I"===t.bound&&t.service_type===H})).sort((function(t,e){return+e.seq-+t.seq})),O:n.filter((function(t){return t.route===O&&"O"===t.bound&&t.service_type===H})).sort((function(t,e){return+e.seq-+t.seq}))}}),[n,O,H]);a.useEffect((function(){L(""),K(""),G("")}),[O]),a.useEffect((function(){K(""),G("")}),[H]),a.useEffect((function(){G("")}),[J]),a.useEffect((function(){}),[P]);var Q=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onRouteAdded({routeNumber:O,service_type:H,direction:J,seq:+P});case 2:if(!e.sent){e.next=5;break}S(""),d(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(T.jsx)(T.Fragment,{children:l?Object(T.jsxs)(g.a,{children:[Object(T.jsx)(m.a,{title:u("add_route"),action:Object(T.jsx)(k.a,{onClick:function(){return d(!1)},children:Object(T.jsx)(R.a,{})})}),Object(T.jsxs)(y.a,{children:[Object(T.jsx)(N.a,{value:O,onChange:function(t,e){S(null!==e&&void 0!==e?e:"")},options:r.map((function(t){return t.route})).filter(A),getOptionLabel:function(t){return t},renderInput:function(t){return Object(T.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:u("route"),variant:"outlined",fullWidth:!0}))}}),O&&Object(T.jsx)(N.a,{value:H,onChange:function(t,e){L(null!==e&&void 0!==e?e:"")},options:r.filter((function(t){return t.route==O})).map((function(t){return t.service_type})).filter(A),getOptionLabel:function(t){return t},renderInput:function(t){return Object(T.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:u("service_type"),variant:"outlined",fullWidth:!0}))}}),H&&Object(T.jsx)(N.a,{value:J,onChange:function(t,e){K(null!==e&&void 0!==e?e:"")},options:["I","O"],getOptionLabel:function(t){var n;return null!==(n=F(e.find((function(e){var n,a;return e.stop===(null===(n=V[t])||void 0===n||null===(a=n.find((function(t){return!0})))||void 0===a?void 0:a.stop)})),c.language))&&void 0!==n?n:""},renderInput:function(t){return Object(T.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:u("direction"),variant:"outlined",fullWidth:!0}))}}),J&&Object(T.jsx)(N.a,{value:P,onChange:function(t,e){G(null!==e&&void 0!==e?e:"")},options:n.filter((function(t){return t.route===O&&t.bound===J})).map((function(t){return t.seq})),getOptionLabel:function(t){var n;return null!==(n=F(e.find((function(e){var n,a;return e.stop===(null===(n=V[J])||void 0===n||null===(a=n.find((function(e){return e.route===O&&e.bound===J&&e.seq===t})))||void 0===a?void 0:a.stop)})),c.language))&&void 0!==n?n:""},renderInput:function(t){return Object(T.jsx)(C.a,Object(b.a)(Object(b.a)({},t),{},{label:u("stop_name"),variant:"outlined",fullWidth:!0}))}}),P&&Object(T.jsx)(_.a,{variant:"contained",color:"primary",onClick:function(){return Q()},children:u("addToMonitorList")})]})]}):Object(T.jsx)(g.a,{children:Object(T.jsx)(y.a,{style:{alignContent:"center",alignItems:"center"},children:Object(T.jsx)(k.a,{onClick:function(){return d(!0)},children:Object(T.jsx)(q.a,{})})})})})},H=n(107),L=n(54),W=n(186),D=n(25),J=n.n(D),K=n(196),M=n(199),B=a.createContext({}),P=function(t){var e=a.useState(""),n=Object(p.a)(e,2),r=n[0],o=n[1];return Object(T.jsx)(B.Provider,{value:{auth:r,setAuth:o},children:t.children})},G=function(){var t=a.useContext(B);return{auth:t.auth,setAuth:t.setAuth}},V=n(74),Q=n(193),U=n(198),X=n(100),Y=n.n(X),Z=(n(139),n(140),Object(h.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})}))),$=function(t){var e,n,r,o=t.data,u=t.stops,c=t.routeStops,i=Object(w.a)(),s=i.t,l=i.i18n,d=(Z(),Object(x.a)(),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=Object(w.a)(),n=(e.t,e.i18n),r=a.useState(J()().locale(n.language)),o=Object(p.a)(r,2),u=o[0],c=o[1];return a.useEffect((function(){var e=setInterval((function(){c(J()().locale(n.language))}),t);return function(){clearInterval(e)}}),[t]),{now:u}}().now),b=a.useMemo((function(){var t;null===o||void 0===o||o.request;return null===o||void 0===o||null===(t=o.eta)||void 0===t?void 0:t.map((function(t){return{etaData:t}}))}),[o]),j=a.useMemo((function(){if(o&&u&&c){var t,e,n=null===o||void 0===o?void 0:o.request;return u[null!==(t=null===(e=c.find((function(t){var e;return t.route===(null===n||void 0===n?void 0:n.routeNumber)&&t.bound===(null===n||void 0===n?void 0:n.direction)&&t.seq===(null===n||void 0===n||null===(e=n.seq)||void 0===e?void 0:e.toString())})))||void 0===e?void 0:e.stop)&&void 0!==t?t:""]}return null}),[o,u,c]);return Object(T.jsx)(T.Fragment,{children:Object(T.jsxs)(g.a,{children:[Object(T.jsx)(m.a,{title:(null===o||void 0===o||null===(e=o.request)||void 0===e?void 0:e.routeNumber)+" - "+(n=j,r=l.language,"zh-HK"===r?null===n||void 0===n?void 0:n.name_tc:"zh-CN"===r?null===n||void 0===n?void 0:n.name_sc:null===n||void 0===n?void 0:n.name_en),action:Object(T.jsx)(k.a,{"aria-label":"delete",onClick:function(){return t.onRemoveClicked(null===o||void 0===o?void 0:o.request)},children:Object(T.jsx)(Y.a,{})})}),Object(T.jsxs)(y.a,{children:[(null==b||b.length<=0)&&Object(T.jsx)(V.a,{variant:"h2",display:"inline",children:s("route_not_available")}),null===b||void 0===b?void 0:b.map((function(t,e){var n,a,r;return Object(T.jsx)(T.Fragment,{children:Object(T.jsxs)(Q.a,{display:"flex",children:[Object(T.jsx)(Q.a,{flexGrow:1,children:null==t.etaData.eta?Object(T.jsx)(V.a,{variant:0===e?"h2":1===e?"h5":"h6",display:"inline",children:s("route_not_available")}):Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)(V.a,{variant:0===e?"h2":1===e?"h5":"h6",display:"inline",children:null===(n=J()(t.etaData.eta))||void 0===n||null===(a=n.locale(l.language))||void 0===a?void 0:a.from(d)}),Object(T.jsx)(U.a,{label:null===(r=J()(t.etaData.eta))||void 0===r?void 0:r.format("HH:mm")})]})}),Object(T.jsx)(Q.a,{})]},"etaRow"+e)})}))]})]})})},tt=Object(h.a)((function(t){return Object(O.a)({root:{backgroundColor:t.palette.background.default}})})),et=[{path:"/:pasteKey?",component:function(){var t,e,n,r,o,u,c,i,s,l,b=Object(d.f)().pasteKey,j=(tt(),Object(x.a)(),G()),h=j.auth,O=(j.setAuth,a.useState("")),g=Object(p.a)(O,2),m=g[0],k=g[1],y=a.useState(null),C=Object(p.a)(y,2),_=C[0],w=C[1],S=Object(K.a)(["gist",b],Object(v.a)(f.a.mark((function t(){var e,n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://api.github.com/gists/".concat(b),{});case 2:return e=t.sent,t.next=5,e.json();case 5:return n=t.sent,k(Object.entries(n.files).find((function(t){return!0}))[0]),t.abrupt("return",JSON.parse(Object.entries(n.files).find((function(t){return!0}))[1].content));case 8:case"end":return t.stop()}}),t)}))),{}),q=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-eta/".concat(e.routeNumber,"/").concat(e.service_type));case 2:return n=t.sent,t.next=5,n.json();case 5:return a=t.sent,t.abrupt("return",a.data.filter((function(t){return t.dir===e.direction&&t.seq===e.seq})));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=Object(M.a)(null!==(t=null===_||void 0===_||null===(e=_.data)||void 0===e?void 0:e.map((function(t){return{queryKey:["routeEta",t.routeNumber,t.service_type,t.direction,t.seq],queryFn:function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,q(t);case 3:return e.t1=e.sent,e.abrupt("return",{request:e.t0,eta:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refetchInterval:1e4,cacheTime:0}})))&&void 0!==t?t:[]),R=Object(K.a)("routes",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route/");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),N=Object(K.a)("stops",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),E=Object(K.a)("routeStops",Object(v.a)(f.a.mark((function t(){var e;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://data.etabus.gov.hk/v1/transport/kmb/route-stop");case 2:return e=t.sent,t.next=5,e.json();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),{refetchInterval:864e5,cacheTime:864e5}),A=a.useMemo((function(){var t={};return N.data&&N.data.data.forEach((function(e){t[e.stop]=e})),t}),[N.data]);a.useEffect((function(){S.data&&w(S.data)}),[S.data]);var F=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={type:"subscribedRouteStop",version:"1.0",generated_timestamp:J()().toDate(),data:null!==(n=null===_||void 0===_||null===(a=_.data)||void 0===a?void 0:a.filter((function(t){return t!==e})))&&void 0!==n?n:[]},t.next=3,fetch("https://api.github.com/gists/".concat(b),{method:"PATCH",headers:{Authorization:"token "+h,"Content-Type":"application/vnd.github.v3.text+json"},body:JSON.stringify({description:"Edit gist",files:Object(L.a)({},m,{content:JSON.stringify(r,null,2)})},null,2)});case 3:t.sent,w(r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),D=function(){var t=Object(v.a)(f.a.mark((function t(e){var n,a,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={type:"subscribedRouteStop",version:"1.0",generated_timestamp:J()().toDate(),data:[].concat(Object(H.a)(null!==(n=null===_||void 0===_?void 0:_.data)&&void 0!==n?n:[]),[e])},t.next=3,fetch("https://api.github.com/gists/".concat(b),{method:"PATCH",headers:{Authorization:"token "+h,"Content-Type":"application/vnd.github.v3.text+json"},body:JSON.stringify({description:"Edit gist",files:Object(L.a)({},m,{content:JSON.stringify(a,null,2)})},null,2)});case 3:return r=t.sent,w(a),t.abrupt("return",r.ok);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(T.jsx)(T.Fragment,{children:null==b?Object(T.jsx)(W.a,{container:!0,spacing:2}):Object(T.jsxs)(W.a,{container:!0,spacing:2,children:[null===I||void 0===I?void 0:I.map((function(t,e){var n,a;return Object(T.jsx)(W.a,{item:!0,xs:12,xl:4,md:6,children:Object(T.jsx)($,{onRemoveClicked:function(t){return F(t)},stops:null!==A&&void 0!==A?A:{},data:t.data,routeStops:null!==(n=null===(a=E.data)||void 0===a?void 0:a.data)&&void 0!==n?n:[]})},"eta"+e)})),Object(T.jsx)(W.a,{item:!0,xs:12,xl:4,md:6,children:Object(T.jsx)(z,{onRouteAdded:function(t){return D(t)},stops:null!==(n=null===(r=N.data)||void 0===r?void 0:r.data)&&void 0!==n?n:[],data:null!==(o=null===(u=S.data)||void 0===u?void 0:u.data)&&void 0!==o?o:[],routes:null!==(c=null===(i=R.data)||void 0===i?void 0:i.data)&&void 0!==c?c:[],routeStops:null!==(s=null===(l=E.data)||void 0===l?void 0:l.data)&&void 0!==s?s:[]})})]})})},routes:[]}],nt=n(104),at=n(189),rt=n(106),ot=n(200),ut=n(187),ct=n(188),it=n(102),st=n.n(it),lt=function(t){var e=a.useState(null),n=Object(p.a)(e,2),r=n[0],o=n[1],u=Object(w.a)(),c=(u.t,u.i18n),i=G(),s=i.auth,l=i.setAuth,d=function(){var t=Object(v.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o(null),e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,c.changeLanguage(e);case 5:J.a.locale(e);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(T.jsxs)(T.Fragment,{children:[Object(T.jsxs)(rt.a,{id:"simple-menu",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(){return d(null)},children:[Object(T.jsx)(ot.a,{onClick:function(){return d("en")},children:"English"}),Object(T.jsx)(ot.a,{onClick:function(){return d("zh-CN")},children:"\u7c21\u9ad4\u4e2d\u6587"}),Object(T.jsx)(ot.a,{onClick:function(){return d("zh-HK")},children:"\u6b63\u9ad4\u4e2d\u6587"})]}),Object(T.jsx)(ut.a,{position:"static",children:Object(T.jsxs)(ct.a,{children:[Object(T.jsx)(k.a,{edge:"end",color:"inherit","aria-label":"language",onClick:function(t){o(t.currentTarget)},children:Object(T.jsx)(st.a,{})}),Object(T.jsx)(C.a,{value:s,onChange:function(t){return l(t.target.value)},placeholder:"GitHub Token",style:{width:500}})]})}),t.children]})},dt=function(){var t=Object(x.a)();return Object(T.jsx)(T.Fragment,{children:Object(T.jsx)(l.a,{children:Object(T.jsx)(d.c,{children:Object(T.jsx)(lt,{children:Object(T.jsx)(at.a,{maxWidth:"xl",style:{paddingTop:t.spacing(2)},children:Object(nt.a)(et)})})})})})},bt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,203)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,o=e.getLCP,u=e.getTTFB;n(t),a(t),r(t),o(t),u(t)}))},jt=n(194),ft=n(73),vt=n(105),pt=n(190),ht=n(191),Ot=new jt.a({defaultOptions:{}}),xt=Object(vt.a)({palette:{type:"dark"}});u.a.render(Object(T.jsx)(r.a.StrictMode,{children:Object(T.jsxs)(pt.a,{theme:xt,children:[Object(T.jsx)(ht.a,{}),Object(T.jsx)(P,{children:Object(T.jsx)(ft.a,{client:Ot,children:Object(T.jsx)(dt,{})})})]})}),document.getElementById("root")),bt()}},[[144,1,2]]]);
//# sourceMappingURL=main.58e30f73.chunk.js.map